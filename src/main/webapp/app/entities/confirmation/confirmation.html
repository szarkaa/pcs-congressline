<div class="row wrapper border-bottom white-bg page-heading">
    <div style="padding-left: 15px">
        <h2 translate="pcsApp.registration.confirmation.title" translate-values="{name: '{{vm.registration.lastName + ', ' + vm.registration.firstName}}'}">Confirmation management of {{vm.registration.lastName + ', ' + vm.registration.firstName}}</h2>
    </div>
</div>
<jhi-alert></jhi-alert>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="col-lg-6 no-padding-left">
            <div class="ibox" ng-show="!vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.confirmation.confirmationTitleType' | translate}}</strong>
                </div>
                <div class="ibox-content">
                    <div><label><input ng-model="vm.confirmationTitleType" value="CONFIRMATION" id="titleTypeConfirmation" name="titleType" type="radio"> Confirmation</label></div>
                    <div><label><input ng-model="vm.confirmationTitleType" value="PRO_FORMA_INVOICE" id="titleTypeProFormaInvoice" name="titleType" type="radio"> Pro forma invoice</label></div>
                </div>
            </div>
            </div>
            <div class="col-lg-6 no-padding-right">
            <div class="ibox" ng-show="!vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.confirmation.language' | translate}}</strong>
                </div>
                <div class="ibox-content">
                    <div><label><input ng-model="vm.language" value="hu" id="languageHu" name="language" type="radio"> Hungarian</label></div>
                    <div><label><input ng-model="vm.language" value="en" id="languageEn" name="language" type="radio"> English</label></div>
                    <div><label><input ng-model="vm.language" value="es" id="languageEs" name="language" type="radio"> Spanish</label></div>
                    <div><label><input ng-model="vm.language" value="pt" id="languagePt" name="language" type="radio"> Portuguese</label></div>
                </div>
            </div>
            </div>

            <div class="ibox" ng-show="!vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.registrationRegistrationType.home.title' | translate}}</strong>
                    <!--<div ibox-tools></div>-->
                </div>
                <div class="ibox-content">
                    <table id="registration-type-datatable" class="table table-striped table-bordered table-hover datatable-with-operations">
                        <thead>
                        <tr>
                            <th><span translate="pcsApp.registrationRegistrationType.registrationType">Registration Type</span></th>
                            <th><span translate="pcsApp.registrationRegistrationType.accPeople">Acc People</span></th>
                            <th><span translate="pcsApp.registrationRegistrationType.regFee">Price</span></th>
                            <th><span translate="pcsApp.registration.confirmation.groupPaid">Group paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceAlreadyPaid">Price already paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceToBePaid">Price to be paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.ignore">Ignore</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="rrt in vm.registrationRegistrationTypes track by rrt.id">
                            <td>{{rrt.registrationTypeName}}</td>
                            <td>{{rrt.accPeople}}</td>
                            <td>{{rrt.chargeableItemPrice + ' ' + rrt.chargeableItemCurrency}}</td>
                            <td>{{vm.getGroupPaid(rrt) + ' ' + rrt.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceAlreadyPaid(rrt.id) + ' ' + rrt.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceToBePaid(rrt.priceWithDiscount, rrt.id) + ' ' + rrt.chargeableItemCurrency}}</td>
                            <td>
                                <input ng-model="vm.ignoredChargeableItems[rrt.id.toString()]" ng-change="vm.toggleIgnoreChargeableItem(rrt.id)" type="checkbox" />
                            </td>
                        </tr>
                        <tr ng-show="vm.registrationRegistrationTypes.length">
                            <td colspan="2">&nbsp;</td>
                            <td><strong>{{ (vm.registrationRegistrationTypes | sumByKey: 'chargeableItemPrice') + ' ' + vm.registrationRegistrationTypes[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{ vm.sumGroupAlreadyPaid(vm.registrationRegistrationTypes) + ' ' + vm.registrationRegistrationTypes[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{ vm.sumPriceAlreadyPaid(vm.registrationRegistrationTypes) + ' ' + vm.registrationRegistrationTypes[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{ vm.sumPriceToBePaid(vm.registrationRegistrationTypes) + ' ' + vm.registrationRegistrationTypes[0].chargeableItemCurrency }}</strong></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="ibox" ng-show="!vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.roomReservation.home.title' | translate}}</strong>
                    <!--<div ibox-tools></div>-->
                </div>
                <div class="ibox-content">
                    <table id="room-reservation-datatable" class="table table-striped table-bordered table-hover datatable-with-operations">
                        <thead>
                        <tr>
                            <th><span translate="pcsApp.roomReservation.id">Res #</span></th>
                            <th><span translate="pcsApp.roomReservation.room">Room type</span></th>
                            <th><span translate="pcsApp.roomReservation.hotel">Hotel</span></th>
                            <th><span translate="pcsApp.roomReservation.shared">Shared</span></th>
                            <th><span translate="pcsApp.roomReservation.arrivalDate">Arrival Date</span></th>
                            <th><span translate="pcsApp.roomReservation.departureDate">Departure Date</span></th>
                            <th><span translate="pcsApp.roomReservation.price">Price</span></th>
                            <th><span translate="pcsApp.registration.confirmation.groupPaid">Group paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceAlreadyPaid">Price already paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceToBePaid">Price to be paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.ignore">Ignore</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="rr in vm.roomReservations track by rr.id">
                            <td>{{rr.id}}</td>
                            <td>{{rr.roomType}}</td>
                            <td>{{rr.hotelName}}</td>
                            <td>{{rr.shared}}</td>
                            <td>{{rr.arrivalDate | date:'mediumDate'}}</td>
                            <td>{{rr.departureDate | date:'mediumDate'}}</td>
                            <td>{{rr.chargeableItemPrice + ' ' + rr.chargeableItemCurrency}}</td>
                            <td>{{vm.getGroupPaid(rr) + ' ' + rr.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceAlreadyPaid(rr.id) + ' ' + rr.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceToBePaid(rr.priceWithDiscount, rr.id) + ' ' + rr.chargeableItemCurrency}}</td>
                            <td>
                                <input ng-model="vm.ignoredChargeableItems[rr.id.toString()]" ng-change="vm.toggleIgnoreChargeableItem(rr.id)" type="checkbox" />
                            </td>
                        </tr>
                        <tr ng-show="vm.roomReservations.length">
                            <td colspan="6">&nbsp;</td>
                            <td><strong>{{ (vm.roomReservations | sumByKey: 'chargeableItemPrice') + ' ' + vm.roomReservations[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{ vm.sumGroupAlreadyPaid(vm.roomReservations) + ' ' + vm.roomReservations[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{ vm.sumPriceAlreadyPaid(vm.roomReservations) + ' ' + vm.roomReservations[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{ vm.sumPriceToBePaid(vm.roomReservations) + ' ' + vm.roomReservations[0].chargeableItemCurrency }}</strong></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="ibox" ng-show="!vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.orderedOptionalService.home.title' | translate}}</strong>
                    <!--<div ibox-tools></div>-->
                </div>
                <div class="ibox-content">
                    <table id="optional-service-datatable" class="table table-striped table-bordered table-hover datatable-with-operations">
                        <thead>
                        <tr>
                            <th><span translate="pcsApp.orderedOptionalService.optionalService">Optional Service</span></th>
                            <th><span translate="pcsApp.orderedOptionalService.participant">Participant</span></th>
                            <th><span translate="pcsApp.orderedOptionalService.price">Price</span></th>
                            <th><span translate="pcsApp.registration.confirmation.groupPaid">Group paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceAlreadyPaid">Price already paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceToBePaid">Price to be paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.ignore">Ignore</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="oos in vm.orderedOptionalServices track by oos.id">
                            <td>{{oos.chargeableItemName}}</td>
                            <td>{{oos.participant}}</td>
                            <td>{{oos.chargeableItemPrice + ' ' + oos.chargeableItemCurrency}}</td>
                            <td>{{vm.getGroupPaid(oos) + ' ' + oos.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceAlreadyPaid(oos.id) + ' ' + oos.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceToBePaid(oos.priceWithDiscount, oos.id) + ' ' + oos.chargeableItemCurrency}}</td>
                            <td>
                                <input ng-model="vm.ignoredChargeableItems[oos.id.toString()]" ng-change="vm.toggleIgnoreChargeableItem(oos.id)" type="checkbox" />
                            </td>
                        </tr>
                        <tr ng-show="vm.orderedOptionalServices.length">
                            <td colspan="2">&nbsp;</td>
                            <td><strong>{{ (vm.orderedOptionalServices | sumByKey: 'chargeableItemPrice') + ' ' + vm.orderedOptionalServices[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{ vm.sumGroupAlreadyPaid(vm.orderedOptionalServices) + ' ' + vm.orderedOptionalServices[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{ vm.sumPriceAlreadyPaid(vm.orderedOptionalServices) + ' ' + vm.orderedOptionalServices[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{ vm.sumPriceToBePaid(vm.orderedOptionalServices) + ' ' + vm.orderedOptionalServices[0].chargeableItemCurrency }}</strong></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="ibox" ng-show="!vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.chargedService.home.title' | translate}}</strong>
                    <!--<div ibox-tools></div>-->
                </div>
                <div class="ibox-content">
                    <table id="charged-service-datatable" class="table table-striped table-bordered table-hover datatable-with-operations">
                        <thead>
                        <tr>
                            <th><span translate="pcsApp.chargedService.paymentMode">Payment mode</span></th>
                            <th><span translate="pcsApp.chargedService.paymentType">Payment type</span></th>
                            <th><span translate="pcsApp.chargedService.chargeableItem">Chargeable item</span></th>
                            <th><span translate="pcsApp.chargedService.amount">Amount</span></th>
                            <th><span translate="pcsApp.chargedService.dateOfPayment">Date of Payment</span></th>
                            <th><span translate="pcsApp.chargedService.invoiceNumber">Invoice number</span></th>
                            <th><span translate="pcsApp.registration.confirmation.ignore">Ignore</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="chargedService in vm.chargedServices track by chargedService.id">
                            <td><span translate="pcsApp.ChargedServicePaymentMode.{{chargedService.paymentMode}}">{{chargedService.paymentMode}}</span></td>
                            <td><span translate="pcsApp.ChargeableItemType.{{chargedService.paymentType}}">{{chargedService.paymentType}}</span></td>
                            <td>{{chargedService.chargeableItemName}}</td>
                            <td>{{chargedService.amount | number : 2}} {{chargedService.chargeableItemCurrency}}</td>
                            <td>{{chargedService.dateOfPayment | date:'mediumDate'}}</td>
                            <td>{{chargedService.invoiceNumber}}</td>
                            <td>
                                <input ng-model="vm.ignoredChargedServices[chargedService.id.toString()]" ng-checked="vm.ignoredChargedServices[chargedService.id.toString()]"
                                       ng-change="vm.toggleIgnoreChargedService(chargedService.id)" type="checkbox" />
                            </td>
                        </tr>
                        <tr ng-show="vm.chargedServices.length">
                            <td colspan="3">&nbsp;</td>
                            <td><strong>{{(vm.chargedServices | sumByKey: 'amount') | number : 2}} {{vm.chargedServices[0].chargeableItemCurrency}}</strong></td>
                            <td colspan="2">&nbsp;</td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="ibox" ng-show="!vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.confirmation.totalDue' | translate}}: {{vm.calculateTotalDue() | number : 2}}</strong>
                </div>
            </div>

            <div class="ibox" ng-show="!vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.registration.optionalText.title' | translate}}:</strong>

                    <div class="input-group m-b">
                        <span class="input-group-btn">
                            <button class="btn btn-primary" type="submit" ui-sref="confirmation.optional-text-new">
                                <i class="fa fa-plus"></i>
                            </button>
                        </span>
                        <ui-select ng-model="vm.selectedOptionalText" ng-change="vm.setOptionalTextMessage($select.selected.optionalText)" name="optionalTextSelector" id="field_optionalTextSelector" theme="bootstrap">
                            <ui-select-match allow-clear="true" placeholder="{{ 'global.form.please.select' | translate }}">
                                <span ng-bind="$select.selected.name"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="optionalText in (vm.optionalTexts | filter: $select.search) track by optionalText.id">
                                <div ng-bind-html="optionalText.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <!--<div ibox-tools></div>-->
                </div>
                <div class="ibox-content">
                    <div class="text-center">
                        <textarea class="form-control" name="optionalText" id="field_optionalText" rows="5" autocomplete="off" ng-model="vm.optionalText">
                        </textarea>
                    </div>
                </div>
            </div>

            <form name="editForm" role="form" novalidate ng-submit="vm.sendAndPrintConfirmation()" show-validation>
            <div class="ibox" ng-show="vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.registration.confirmation.email' | translate}}:</strong>
                    <div class="input-group m-b">
                        <input class="form-control" name="confirmationEmail" ng-minlength="5" ng-maxlength="255" ng-model="vm.confirmationEmail" type="email" required>
                        <span class="input-group-btn">
                            <button type="submit" class="btn btn-primary"><span translate="entity.action.send">Send</span></button>
                            <button type="button" ng-click="vm.isShowConfirmationPanel = false;" class="btn btn-default"><span translate="entity.action.cancel">Cancel</span></button>
                        </span>
                    </div>
                    <div ng-show="editForm.confirmationEmail.$invalid">
                        <p class="error-block"
                           ng-show="editForm.confirmationEmail.$error.required" translate="entity.validation.required">
                            This field is required.
                        </p>
                        <p class="error-block"
                           ng-show="editForm.confirmationEmail.$error.email" translate="global.messages.validate.email.invalid">
                            Your e-mail is invalid.
                        </p>
                        <p class="error-block"
                           ng-show="editForm.confirmationEmail.$error.minlength" translate="entity.validation.minlength" translate-value-min="5">
                            This field is required to be at least 5 characters.
                        </p>
                        <p class="error-block"
                           ng-show="editForm.confirmationEmail.$error.maxlength" translate="entity.validation.maxlength" translate-value-max="255">
                            This field cannot be longer than 255 characters.
                        </p>
                    </div>
                </div>
            </div>
            </form>

            <div class="ibox" ng-show="!vm.isShowConfirmationPanel">
                <div class="ibox-title float-e-margins">
                    <button type="button" ng-click="vm.showConfirmationPanel()" ng-disabled="vm.isSaving" class="btn btn-primary">
                        <span class="glyphicon glyphicon-save"></span>&nbsp;<span translate="pcsApp.registration.confirmation.sendConfirmationByMail">Send confirmation by mail</span>
                    </button>
                    <button type="button" ng-click="vm.printConfirmation()" ng-disabled="vm.isSaving" class="btn btn-primary">
                        <span class="glyphicon glyphicon-print"></span>&nbsp;<span translate="pcsApp.registration.confirmation.printConfirmation">Print confirmation</span>
                    </button>
                    <button type="button" class="btn btn-default" ui-sref="registration({id: registration.id})">
                        <span class="glyphicon glyphicon-ban-circle"></span>&nbsp;<span translate="entity.action.cancel">Cancel</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
