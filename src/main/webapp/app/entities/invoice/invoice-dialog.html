<div class="row wrapper border-bottom white-bg page-heading">
    <div style="padding-left: 15px">
        <h2 translate="pcsApp.invoice.home.createLabel" translate-values="{lastName: '{{vm.invoice.registration.lastName}}', firstName: '{{vm.invoice.registration.firstName}}'}">Create a new invoice for {{vm.invoice.registration.lastName + ', ' + invoice.registration.firstName}}</h2>
    </div>
</div>
<jhi-alert></jhi-alert>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.registrationRegistrationType.home.title' | translate}}</strong>
                </div>
                <div class="ibox-content">
                    <table id="registration-type-datatable" class="table table-striped table-bordered table-hover datatable-with-operations">
                        <thead>
                        <tr>
                            <th><span translate="pcsApp.registrationRegistrationType.registrationType">Registration Type</span></th>
                            <th><span translate="pcsApp.registrationRegistrationType.accPeople">Acc People</span></th>
                            <th><span translate="pcsApp.registrationRegistrationType.regFee">Price</span></th>
                            <th><span translate="pcsApp.registration.confirmation.groupPaid">Group paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceAlreadyPaid">Price already paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceToBePaid">Price to be paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.ignore">Ignore</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="rrt in vm.registrationRegistrationTypes track by rrt.id">
                            <td>{{rrt.registrationTypeName}}</td>
                            <td>{{rrt.accPeople}}</td>
                            <td>{{rrt.chargeableItemPrice | number : 2}} {{rrt.chargeableItemCurrency}}</td>
                            <td>{{vm.getGroupPaid(rrt) + ' ' + rrt.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceAlreadyPaid(rrt.id) | number : 2}} {{rrt.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceToBePaid(rrt.priceWithDiscount, rrt.id) | number : 2}} {{rrt.chargeableItemCurrency}}</td>
                            <td>
                                <input ng-model="vm.invoice.ignoredChargeableItems[rrt.id.toString()]" ng-checked="vm.invoice.ignoredChargeableItems[rrt.id.toString()]"
                                       ng-disabled="vm.isChargeableItemDisabled(rrt.id)" ng-change="vm.toggleIgnoreChargeableItem(rrt.id)" type="checkbox" />
                            </td>
                        </tr>
                        <tr ng-show="vm.registrationRegistrationTypes.length">
                            <td colspan="2">&nbsp;</td>
                            <td><strong>{{(vm.registrationRegistrationTypes | sumByKey: 'chargeableItemPrice') | number : 2}} {{vm.registrationRegistrationTypes[0].chargeableItemCurrency}}</strong></td>
                            <td><strong>{{ vm.sumGroupAlreadyPaid(vm.registrationRegistrationTypes) + ' ' + vm.registrationRegistrationTypes[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{vm.sumPriceAlreadyPaid(vm.registrationRegistrationTypes) | number : 2}} {{vm.registrationRegistrationTypes[0].chargeableItemCurrency}}</strong></td>
                            <td><strong>{{vm.sumPriceToBePaid(vm.registrationRegistrationTypes) | number : 2}} {{vm.registrationRegistrationTypes[0].chargeableItemCurrency}}</strong></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="ibox">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.roomReservation.home.title' | translate}}</strong>
                    <!--<div ibox-tools></div>-->
                </div>
                <div class="ibox-content">
                    <table id="room-reservation-datatable" class="table table-striped table-bordered table-hover datatable-with-operations">
                        <thead>
                        <tr>
                            <th><span translate="pcsApp.roomReservation.id">Res #</span></th>
                            <th><span translate="pcsApp.roomReservation.room">Room type</span></th>
                            <th><span translate="pcsApp.roomReservation.hotel">Hotel</span></th>
                            <th><span translate="pcsApp.roomReservation.shared">Shared</span></th>
                            <th><span translate="pcsApp.roomReservation.arrivalDate">Arrival Date</span></th>
                            <th><span translate="pcsApp.roomReservation.departureDate">Departure Date</span></th>
                            <th><span translate="pcsApp.roomReservation.price">Price</span></th>
                            <th><span translate="pcsApp.registration.confirmation.groupPaid">Group paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceAlreadyPaid">Price already paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceToBePaid">Price to be paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.ignore">Ignore</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="rr in vm.roomReservations track by rr.id">
                            <td>{{rr.id}}</td>
                            <td>{{rr.roomType}}</td>
                            <td>{{rr.hotelName}}</td>
                            <td>{{rr.shared}}</td>
                            <td>{{rr.arrivalDate | date:'mediumDate'}}</td>
                            <td>{{rr.departureDate | date:'mediumDate'}}</td>
                            <td>{{rr.chargeableItemPrice | number : 2}} {{rr.chargeableItemCurrency}}</td>
                            <td>{{vm.getGroupPaid(rr) + ' ' + rr.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceAlreadyPaid(rr.id) | number : 2}} {{rr.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceToBePaid(rr.priceWithDiscount, rr.id) | number : 2}} {{rr.chargeableItemCurrency}}</td>
                            <td>
                                <input ng-model="vm.invoice.ignoredChargeableItems[rr.id.toString()]" ng-checked="vm.invoice.ignoredChargeableItems[rr.id.toString()]"
                                       ng-disabled="vm.isChargeableItemDisabled(rr.id)" ng-change="vm.toggleIgnoreChargeableItem(rr.id)" type="checkbox" />
                            </td>
                        </tr>
                        <tr ng-show="vm.roomReservations.length">
                            <td colspan="6">&nbsp;</td>
                            <td><strong>{{(vm.roomReservations | sumByKey: 'chargeableItemPrice') | number : 2}} {{vm.roomReservations[0].chargeableItemCurrency}}</strong></td>
                            <td><strong>{{ vm.sumGroupAlreadyPaid(vm.roomReservations) + ' ' + vm.roomReservations[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{vm.sumPriceAlreadyPaid(vm.roomReservations) | number : 2}} {{vm.roomReservations[0].chargeableItemCurrency}}</strong></td>
                            <td><strong>{{vm.sumPriceToBePaid(vm.roomReservations) | number : 2}} {{vm.roomReservations[0].chargeableItemCurrency}}</strong></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="ibox">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.orderedOptionalService.home.title' | translate}}</strong>
                    <!--<div ibox-tools></div>-->
                </div>
                <div class="ibox-content">
                    <table id="optional-service-datatable" class="table table-striped table-bordered table-hover datatable-with-operations">
                        <thead>
                        <tr>
                            <th><span translate="pcsApp.orderedOptionalService.optionalService">Optional Service</span></th>
                            <th><span translate="pcsApp.orderedOptionalService.participant">Participant</span></th>
                            <th><span translate="pcsApp.orderedOptionalService.price">Price</span></th>
                            <th><span translate="pcsApp.registration.confirmation.groupPaid">Group paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceAlreadyPaid">Price already paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.priceToBePaid">Price to be paid</span></th>
                            <th><span translate="pcsApp.registration.confirmation.ignore">Ignore</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="oos in vm.orderedOptionalServices track by oos.id">
                            <td>{{oos.chargeableItemName}}</td>
                            <td>{{oos.participant}}</td>
                            <td>{{oos.chargeableItemPrice | number : 2}} {{oos.chargeableItemCurrency}}</td>
                            <td>{{vm.getGroupPaid(oos) + ' ' + oos.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceAlreadyPaid(oos.id) | number : 2}} {{oos.chargeableItemCurrency}}</td>
                            <td>{{vm.getPriceToBePaid(oos.priceWithDiscount, oos.id) | number : 2}} {{oos.chargeableItemCurrency}}</td>
                            <td>
                                <input ng-model="vm.invoice.ignoredChargeableItems[oos.id.toString()]" ng-checked="vm.invoice.ignoredChargeableItems[oos.id.toString()]"
                                       ng-disabled="vm.isChargeableItemDisabled(oos.id)" ng-change="vm.toggleIgnoreChargeableItem(oos.id)" type="checkbox" />
                            </td>
                        </tr>
                        <tr ng-show="vm.orderedOptionalServices.length">
                            <td colspan="2">&nbsp;</td>
                            <td><strong>{{(vm.orderedOptionalServices | sumByKey: 'chargeableItemPrice') | number : 2}} {{vm.orderedOptionalServices[0].chargeableItemCurrency}}</strong></td>
                            <td><strong>{{ vm.sumGroupAlreadyPaid(vm.orderedOptionalServices) + ' ' + vm.orderedOptionalServices[0].chargeableItemCurrency }}</strong></td>
                            <td><strong>{{vm.sumPriceAlreadyPaid(vm.orderedOptionalServices) | number : 2}} {{vm.orderedOptionalServices[0].chargeableItemCurrency}}</strong></td>
                            <td><strong>{{vm.sumPriceToBePaid(vm.orderedOptionalServices) | number : 2}} {{vm.orderedOptionalServices[0].chargeableItemCurrency}}</strong></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="ibox">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.chargedService.home.title' | translate}}</strong>
                    <!--<div ibox-tools></div>-->
                </div>
                <div class="ibox-content">
                    <table id="charged-service-datatable" class="table table-striped table-bordered table-hover datatable-with-operations">
                        <thead>
                        <tr>
                            <th><span translate="pcsApp.chargedService.paymentMode">Payment mode</span></th>
                            <th><span translate="pcsApp.chargedService.paymentType">Payment type</span></th>
                            <th><span translate="pcsApp.chargedService.chargeableItem">Chargeable item</span></th>
                            <th><span translate="pcsApp.chargedService.amount">Amount</span></th>
                            <th><span translate="pcsApp.chargedService.dateOfPayment">Date of Payment</span></th>
                            <th><span translate="pcsApp.chargedService.invoiceNumber">Invoice number</span></th>
                            <th><span translate="pcsApp.registration.confirmation.ignore">Ignore</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="chargedService in vm.chargedServices track by chargedService.id">
                            <td><span translate="pcsApp.ChargedServicePaymentMode.{{chargedService.paymentMode}}">{{chargedService.paymentMode}}</span></td>
                            <td><span translate="pcsApp.ChargeableItemType.{{chargedService.paymentType}}">{{chargedService.paymentType}}</span></td>
                            <td>{{chargedService.chargeableItemName}}</td>
                            <td>{{chargedService.amount | number : 2}} {{chargedService.chargeableItemCurrency}}</td>
                            <td>{{chargedService.dateOfPayment | date:'mediumDate'}}</td>
                            <td>{{chargedService.invoiceNumber}}</td>
                            <td>
                                <input ng-model="vm.invoice.ignoredChargedServices[chargedService.id.toString()]" ng-checked="vm.invoice.ignoredChargedServices[chargedService.id.toString()]"
                                       ng-disabled="vm.isChargedServiceDisabled(chargedService.id)" ng-change="vm.toggleIgnoreChargedService(chargedService.id)" type="checkbox" />
                            </td>
                        </tr>
                        <tr ng-show="vm.chargedServices.length">
                            <td colspan="3">&nbsp;</td>
                            <td><strong>{{(vm.chargedServices | sumByKey: 'amount') | number : 2}} {{vm.chargedServices[0].chargeableItem.chargeableItemCurrency}}</strong></td>
                            <td colspan="2">&nbsp;</td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="ibox">
                <div class="ibox-title float-e-margins">
                    <strong>{{'pcsApp.invoice.totalDue' | translate}}: {{vm.calculateTotalDue() | number : 2}}</strong>
                </div>
            </div>

            <div class="ibox">
                <div class="ibox-title float-e-margins">
                    <button type="button" ui-sref="invoice.setup" ng-disabled="editForm.$invalid || !vm.isInvoiceable()" class="btn btn-primary">
                        <span class="glyphicon glyphicon-save"></span>&nbsp;<span translate="pcsApp.invoice.createInvoice">Create invoice</span>
                    </button>
                    <button type="button" class="btn btn-default" ui-sref="invoice({id: invoice.registration.id})">
                        <span class="glyphicon glyphicon-ban-circle"></span>&nbsp;<span translate="entity.action.cancel">Cancel</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
